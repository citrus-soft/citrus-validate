!function(e){"use strict";function t(e){return e.replace(/\(|\)|\s+|-/g,"")}Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t});var n={required:"Это поле необходимо заполнить.",email:"Пожалуйста, введите корректный адрес электронной почты.",url:"Пожалуйста, введите корректный URL.",date:"Пожалуйста, введите корректную дату.",number:"Пожалуйста, введите число.",confirm_password:"Пароли не совпадают.",maxlength:"Пожалуйста, введите не больше {0} символов.",minlength:"Пожалуйста, введите не меньше {0} символов.",rangelength:"Пожалуйста, введите значение длиной от {0} до {1} символов.",range:"Пожалуйста, введите число от {0} до {1}.",max:"Пожалуйста, введите число, меньшее или равное {0}.",min:"Пожалуйста, введите число, большее или равное {0}.",phone_all:"Пожалуйста, введите корректный номер телефона.",phone:"Пожалуйста, введите корректный номер телефона.",inn:"Пожалуйста, введите корректный ИНН.",inn_u:"Пожалуйста, введите корректный ИНН юр лица.",inn_f:"Пожалуйста, введите корректный ИНН физ лица.",ogrn:"Пожалуйста, введите корректный ОГРН.",kpp:"Пожалуйста, введите корректный КПП.",filetype:"Не верный тип файла. Возможные типы: {0}."},r={file:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;for(var r=!0,i=0;i<n.get(0).files.length;i++){var a=n[0].files[i];if("name"in a){var l=a.name.split(".");l=l[l.length-1].toLocaleLowerCase(),e.params.filetype.indexOf(l)+1||(r=!1)}}var s=r?"":this.getMessage.call(e,"filetype",[e.params.filetype]);t(e,s)},required:function(t,n){var r=t.$el.get(0),i="checkbox"===r.type?r.checked:"radio"===r.type?e('[name="'+r.name+'"]:checked').length:""!==e.trim(r.value),a=i?"":this.getMessage.call(t,"required");n(t,a)},important:function(e,t){t(e)},phone_all:function(e,n){var r=e.$el;if(!r.val())return n(e),!0;var i=t(r.val()),a=i.length>5&&/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{6,10}$/.test(i),l=a?"":this.getMessage.call(e,"phone_all");n(e,l)},phone:function(e,n){var r=e.$el;if(!r.val())return n(e),!0;var i=t(r.val()),a=i.length>10&&/^(8|\+7){1}(\d{10})$/.test(i),l=a?"":this.getMessage.call(e,"phone");n(e,l)},ajax:function(t,n){var r=t.$el;if(!r.val())return n(t),!0;var i=t.params.ajaxUrl;i.length>0&&e.ajax({url:i,type:"POST",dataType:"html",data:{name:r.attr("name"),value:r.val()}}).done(function(e){return e.length>0?void n(t,e):void n(t)}).fail(function(){console.error("error"),n(t)})},email:function(t,n){var r=t.$el;if(!r.val())return n(t),!0;var i=e.trim(r.val()),a=/^(|(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6})$/.test(i),l=a?"":this.getMessage.call(t,"email");n(t,l)},number:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(n.val());if(!r)return void t(e,this.getMessage.call(e,"number"));var i,a,l=+n.val(),s="",o=!1,c=!1;"undefined"!=typeof e.params.min&&""!==e.params.min&&(i=+e.params.min,o=!0),"undefined"!=typeof e.params.max&&""!==e.params.max&&(a=+e.params.max,c=!0),o&&c?(l<i||l>a)&&(s=this.getMessage.call(e,"range",[i,a])):(o&&l<i&&(s=this.getMessage.call(e,"min",[i])),c&&l>a&&(s=this.getMessage.call(e,"max",[a]))),t(e,s)},length:function(e,t){var n=e.$el,r=e.params.minlength,i=e.params.maxlength,a=n.val().length,l=!1;"undefined"!=typeof r&&"undefined"!=typeof i?(a>i||a<r)&&(l=this.getMessage.call(e,"rangelength",[r,i])):"undefined"!=typeof r?a<r&&(l=this.getMessage.call(e,"minlength",[r])):"undefined"!=typeof i&&a>i&&(l=this.getMessage.call(e,"maxlength",[i])),t(e,l)},main_password:function(t,n){var r=t.$el,i=this.filterField(function(t){return e.inArray("confirm_password",t.arRules)+1})[0];i.$el.val()&&r.val()&&this.validateField(i),n(t)},confirm_password:function(t,n){var r=t.$el;if(!r.val())return n(t),!0;var i=this.filterField(function(t){return e.inArray("main_password",t.arRules)+1})[0],a=r.val()===i.$el.val(),l=a?"":this.getMessage.call(t,"confirm_password");n(t,l)},url:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(n.val()),i=r?"":this.getMessage.call(e,"url");t(e,i)},inn:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=n.val(),i=!0;if(r.match(/\D/))i=!1;else{if(12!=r.length&&10!=r.length&&(i=!1),10==r.length){var a=String((2*r[0]+4*r[1]+10*r[2]+3*r[3]+5*r[4]+9*r[5]+4*r[6]+6*r[7]+8*r[8])%11%10);i=r[9]==a}if(12==r.length){var l=String((7*r[0]+2*r[1]+4*r[2]+10*r[3]+3*r[4]+5*r[5]+9*r[6]+4*r[7]+6*r[8]+8*r[9])%11%10),s=String((3*r[0]+7*r[1]+2*r[2]+4*r[3]+10*r[4]+3*r[5]+5*r[6]+9*r[7]+4*r[8]+6*r[9]+8*r[10])%11%10);i=r[10]==l&&r[11]==s}}var o=i?"":this.getMessage.call(e,"inn");t(e,o)},inn_u:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=n.val(),i=!0;r.match(/\D/)&&(i=!1),10!=r.length&&(i=!1);var a=String((2*r[0]+4*r[1]+10*r[2]+3*r[3]+5*r[4]+9*r[5]+4*r[6]+6*r[7]+8*r[8])%11%10);i=r[9]==a;var l=i?"":this.getMessage.call(e,"inn_u");t(e,l)},inn_f:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=n.val(),i=!0;r.match(/\D/)&&(i=!1),i=12==r.length&&r[10]==(7*r[0]+2*r[1]+4*r[2]+10*r[3]+3*r[4]+5*r[5]+9*r[6]+4*r[7]+6*r[8]+8*r[9])%11%10&&r[11]==(3*r[0]+7*r[1]+2*r[2]+4*r[3]+10*r[4]+3*r[5]+5*r[6]+9*r[7]+4*r[8]+6*r[9]+8*r[10])%11%10;var a=i?"":this.getMessage.call(e,"inn_f");t(e,a)},ogrn:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=n.val(),i=!0;i=13==r.length&&r.slice(-1)==(r.slice(0,-1)%11+"").slice(-1)||15==r.length&&r.slice(-1)==(r.slice(0,-1)%13+"").slice(-1);var a=i?"":this.getMessage.call(e,"ogrn");t(e,a)},kpp:function(e,t){var n=e.$el;if(!n.val())return t(e),!0;var r=n.val(),i=!0;r.match(/\D/)&&(i=!1),r.match(/([0-9]{1}[1-9]{1}|[1-9]{1}[0-9]{1})([0-9]{2})([0-9A-F]{2})([0-9]{3})/)||(i=!1);var a=i?"":this.getMessage.call(e,"kpp");t(e,a)}},i={addFieldError:function(e,t){var n=e.parents(".input-container");n.addClass("has-error").removeClass("has-success");var r=t.join("<br>"),i=n.find(".error.help-block");i.length>0?i.html(r):n.append('<div class="error help-block">'+r+"</div>")},removeFieldError:function(e){e.parents(".input-container").removeClass("has-error").addClass("has-success")},clearField:function(e){e.parents(".input-container").removeClass("has-error").removeClass("has-success")},lockField:function(e){this.callEvent("removeFieldError",e),e.attr("readonly","readonly").closest(".input-container").addClass("ajax-loading")},unlockField:function(e){e.removeAttr("readonly").closest(".input-container").removeClass("ajax-loading")},lockForm:function(){var e=this;e.isLocked=!0,e.$form.find(e.settings.submitBtn).attr("disabled","disabled")},unlockForm:function(){var e=this;e.isLocked=!1,e.$form.find(e.settings.submitBtn).removeAttr("disabled")},afterFormValidate:function(){this.isValid&&this.$form.submit()},scrollToFirstError:function(){var e=this.filterField(function(e){return e.isValid===!1});e.length&&e[0].$el.first().focus()},reset:function(){var e=this;e.$form[0].reset(),e.fields.forEach(function(t,n,r){e.callEvent("clearField",t.$el),delete t.isValid}),e.callEvent(e.checkImportant()?"unlockForm":"lockForm")}},a=new function(){this._getMessage=function(e,t){if(n[e]&&n[e].length>0){var r=n[e];return t&&t.length>0?(t.forEach(function(e,t){r=r.replace("{"+t+"}",e)}),r):r}if(!n[e])return n},this._setMessage=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var i in t){if("string"!=typeof t[i])return!1;n[i]=t[i]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof r&&(n[t]=r,!0)},this._getRule=function(e){return e?r[e]||!1:r},this._setRule=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var i in t){if(!e.isFunction(t[i]))return!1;r[i]=t[i]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(n))&&(r[t]=n,!0)},this._getEvent=function(e){return e?i[e]||function(){}:i},this._setEvent=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var r in t){if("string"!=typeof r||!e.isFunction(t[r]))return!1;i[r]=t[r]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(n))&&(i[t]=n,!0)}};window.citrusValidator=function(t,n){if(!t||1!=t.length)throw new Error("citrusValidator: ошибка в аргументе form");var r=this,i=Object.create(r._getRule()),a=Object.create(r._getMessage()),l=Object.create(r._getEvent());r.settings=e.extend({submitBtn:":submit"},n),r.$form=t,r.fields=Array(),r.isLocked=!1,r.getMessage=function(t,n){var r=this.messages&&this.messages[t]?this.messages[t]:a[t]?a[t]:"";return r.length>0&&"array"===e.type(n)&&n.length>0&&n.forEach(function(e,t){r=r.replace("{"+t+"}",e)}),r},r.setMessage=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var r in t){if("string"!=typeof t[r])return!1;a[r]=t[r]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof n&&(a[t]=n,!0)},r.getRule=function(e){return e?i[e]||!1:i},r.setRule=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var r in t){if(!e.isFunction(t[r]))return!1;i[r]=t[r]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(n))&&(i[t]=n,!0)},r.getEvent=function(e){return e?l[e]||!1:l},r.setEvent=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var r in t){if("string"!=typeof r||!e.isFunction(t[r]))return!1;l[r]=t[r]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(n))&&(l[t]=n,!0)},r.callEvent=function(e,t,n){if(e)return this.getEvent(e).call(this,t,n),this},r.getField=function(t){return t?r.fields.filter(function(n){return e(n.$el).is(t)}):r.fields},r.filterField=function(t){if(!t||!e.isFunction(t))throw new Error("citrusValidator: ошибка в аргументе функции filterField");return r.fields.filter(t)},r.validateField=function(t,n,i){var t=e.isArray(t)?t:Array(t),n=void 0===n||n,i=i||function(){};t.forEach(function(t){function a(){t.params.lockOnValid&&r.callEvent("unlockField",t.$el),t.errors=s,t.params.trigger||t.$el.is(":checkbox, :file, :radio, select")||(t.params.trigger="keyup"),s.length>0?(n&&r.callEvent("addFieldError",t.$el,s),t.$el.trigger("validError",[t]),t.isValid=!1):t.$el.is(":checkbox, :radio")||t.$el.val()?(n&&r.callEvent("removeFieldError",t.$el),t.$el.trigger("validSucess",[t]),t.isValid=!0):(n&&r.callEvent("clearField",t.$el),delete t.isValid),i(t,s)}t.params.lockOnValid&&r.callEvent("lockField",t.$el);var l=t.arRules.length,s=Array();return t.$el.prop("disabled")?(n&&r.callEvent("clearField",t.$el),delete t.isValid,void a()):l?void t.arRules.forEach(function(n){var i=r.getRule(n);return i&&e.isFunction(i)?(i.call(r,t,function(e,t){t&&(s[s.length]=t),--l||a()}),!0):(console.log("citrusValidator: Нет правила '"+n+"'"),--l||a(),!0)}):(a(),!0)})},r.validateForm=function(e,t){var t=t||function(){},e="undefined"==typeof e||!!e,n=r.fields.length;return r.isValid=!0,n?void r.fields.forEach(function(i){void 0!==i.isValid&&"submit"!==i.params.trigger?(i.isValid||(r.isValid=!1),--n||(t(r),e&&r.callEvent("afterFormValidate"),e&&r.callEvent("scrollToFirstError"))):r.validateField(i,e,function(i){i.isValid||void 0===i.isValid||(r.isValid=!1),--n||(t(r),e&&r.callEvent("afterFormValidate"),e&&r.callEvent("scrollToFirstError"))})}):(t(r),e&&r.callEvent("afterFormValidate"),!0)},r.checkImportant=function(){var e=r.filterField(function(e){return!!e.params.important}),t=!0;return e.length>0&&e.forEach(function(e){return void 0!==e.isValid?void(e.isValid||(t=!1)):void r.validateField(e,!1,function(e){e.isValid||(t=!1)})}),t},r.addField=function(t,n,i,a){if(!t||"object"!==e.type(t)||!t.length)throw new Error("citrusValidator: ошибка в аргументе $fields");var n=n||[],i=i||{},a=a||{};return t.each(function(t,l){var s=e("radio"==e(this).prop("type")?'[name="'+e(this).prop("name")+'"]':this),o=r.getField(e(l));return o.length?(o=o[0],o.arRules=e.unique(e.merge(o.arRules,n)),o.params=e.extend(!0,o.params,i),void(o.messages=e.extend(!0,o.messages,a))):(r.fields[r.fields.length]={$el:s,arRules:n,params:i,messages:a},void s.on("change keyup",function(t){if(13!=t.keyCode){var n=r.getField(e(this))[0]||!1;if(!n)return void console.error("Нет поля в массиве полей v.fields");var i=n.params.trigger||"change";if(!(i.indexOf(t.type)<0)){var a=r.getField(e(this));r.validateField(a,!0,function(e){e.params.important&&r.callEvent(r.checkImportant()?"unlockForm":"lockForm")})}}}))}),t},function(){r.$form.find("[data-valid], [data-valid-params], [data-valid-messages]").each(function(t,n){var i=e(n).data("valid")?e(n).data("valid").split(" "):[],a=e(n).data("valid-params")||{},l=e(n).data("valid-messages")||{};(i||a)&&r.addField(e(n),i,a,l)}),r.$form.on("click",r.settings.submitBtn,function(t){t.preventDefault(),e(this).attr("disabled")||r.validateForm()}),":submit"!==r.settings.submitBtn&&r.$form.on("keypress",function(e){13==e.keyCode&&"textarea"!==e.target.type&&(e.preventDefault(),r.validateForm())}),r.checkImportant()||r.callEvent("lockForm")}()},citrusValidator.prototype=a}(jQuery);