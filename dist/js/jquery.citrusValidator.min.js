!function(e){"use strict";function t(e){return e.replace(/\(|\)|\s+|-/g,"")}function r(e,t){var r=!1;return"number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length?/[^0-9]/.test(e)?(t.code=2,t.message="БИК может состоять только из цифр"):9!==e.length?(t.code=3,t.message="БИК может состоять только из 9 цифр"):r=!0:(t.code=1,t.message="БИК пуст"),r}function a(e,t){var r=!1;if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))t.code=2,t.message="ИНН может состоять только из цифр";else if(-1===[10,12].indexOf(e.length))t.code=3,t.message="ИНН может состоять только из 10 или 12 цифр";else{var a=function(e,t){var r=0;for(var a in t)r+=t[a]*e[a];return parseInt(r%11%10)};switch(e.length){case 10:var i=a(e,[2,4,10,3,5,9,4,6,8]);i===parseInt(e[9])&&(r=!0);break;case 12:var n=a(e,[7,2,4,10,3,5,9,4,6,8]),s=a(e,[3,7,2,4,10,3,5,9,4,6,8]);n===parseInt(e[10])&&s===parseInt(e[11])&&(r=!0)}r||(t.code=4,t.message="Неправильное контрольное число")}else t.code=1,t.message="ИНН пуст";return r}function i(e,t){var r=!1;return"number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length?9!==e.length?(t.code=2,t.message="КПП может состоять только из 9 знаков (цифр или заглавных букв латинского алфавита от A до Z)"):/^[0-9]{4}[0-9A-Z]{2}[0-9]{3}$/.test(e)?r=!0:(t.code=3,t.message="Неправильный формат КПП"):(t.code=1,t.message="КПП пуст"),r}function n(e,t,a){var i=!1;if(r(t,a))if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))a.code=2,a.message="К/С может состоять только из цифр";else if(20!==e.length)a.code=3,a.message="К/С может состоять только из 20 цифр";else{var n="0"+t.toString().slice(4,6)+e,s=0,l=[7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1];for(var o in l)s+=l[o]*(n[o]%10);s%10==0?i=!0:(a.code=4,a.message="Неправильное контрольное число")}else a.code=1,a.message="К/С пуст";return i}function s(e,t){var r=!1;if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))t.code=2,t.message="ОГРН может состоять только из цифр";else if(13!==e.length)t.code=3,t.message="ОГРН может состоять только из 13 цифр";else{var a=parseInt((parseInt(e.slice(0,-1))%11).toString().slice(-1));a===parseInt(e[12])?r=!0:(t.code=4,t.message="Неправильное контрольное число")}else t.code=1,t.message="ОГРН пуст";return r}function l(e,t){var r=!1;if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))t.code=2,t.message="ОГРНИП может состоять только из цифр";else if(15!==e.length)t.code=3,t.message="ОГРНИП может состоять только из 15 цифр";else{var a=parseInt((parseInt(e.slice(0,-1))%13).toString().slice(-1));a===parseInt(e[14])?r=!0:(t.code=4,t.message="Неправильное контрольное число")}else t.code=1,t.message="ОГРНИП пуст";return r}function o(e,t,a){var i=!1;if(r(t,a))if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))a.code=2,a.message="Р/С может состоять только из цифр";else if(20!==e.length)a.code=3,a.message="Р/С может состоять только из 20 цифр";else{var n=t.toString().slice(-3)+e,s=0,l=[7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1,3,7,1];for(var o in l)s+=l[o]*(n[o]%10);s%10==0?i=!0:(a.code=4,a.message="Неправильное контрольное число")}else a.code=1,a.message="Р/С пуст";return i}function c(e,t){var r=!1;if("number"==typeof e?e=e.toString():"string"!=typeof e&&(e=""),e.length)if(/[^0-9]/.test(e))t.code=2,t.message="СНИЛС может состоять только из цифр";else if(11!==e.length)t.code=3,t.message="СНИЛС может состоять только из 11 цифр";else{for(var a=0,i=0;i<9;i++)a+=parseInt(e[i])*(9-i);var n=0;a<100?n=a:a>101&&100===(n=parseInt(a%101))&&(n=0),n===parseInt(e.slice(-2))?r=!0:(t.code=4,t.message="Неправильное контрольное число")}else t.code=1,t.message="СНИЛС пуст";return r}Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t});var u=function(e){return void 0!==e&&null!==e},f={required:"This Field is required.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",number:"Please enter a number.",confirm_password:"Passwords do not match.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} to {1} characters.",range:"Please enter a number between {0} to {1}.",max:"Please enter a number less than or equal to {0}.",min:"Please enter a number greater than or equal to {0}.",phone_all:"Please enter a valid phone number.",phone:"Please enter a valid phone number.",filetype:"Invalid file type. Possible types: {0}.",filesize:"The file size should be no more than {0}",group:"Please fill in the {0}.",or:"or",orGroup:"Fill one of the fields: {0}",andGroup:"Fill in the fields: {0}",groupAnd:"Required fields",ruleGroup:"Wrong format",recaptcha:"Anti-spam protection",inn:"Please enter a valid INN.",inn_u:"Please enter a valid INN of a legal entity.",inn_f:"Please enter a valid INN of a natural person.",ogrn:"Please enter a valid OGRN.",kpp:"Please enter a valid KPP.",bik:"Wrong BIK",ogrnip:"Wrong OGRNIP",ks:"Wrong K/S",rs:"Wrong R/S",snils:"Wrong SNILS"},d={ruleGroup:function(t,r){var a,i=this,n=!1;if(e.isArray(t.params.ruleGroup)&&t.params.ruleGroup.length){a=t.params.ruleGroup.length;var s=function(){var e=n?"":i.getMessage.call(t,"ruleGroup");r(t,e)};t.params.ruleGroup.forEach(function(r){var l=i.getRule(r);if(!l||!e.isFunction(l))return console.error("citrusValidator: Нет правила '"+r+"'"),--a||s(),!0;l.call(i,t,function(e,t){t||(n=!0),--a||s()})})}},file:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;for(var a=!0,i=0,n=0;n<r.get(0).files.length;n++){var s=r[0].files[n];if("name"in s){var l=s.name.split(".");l=l[l.length-1].toLocaleLowerCase(),e.params.filetype.indexOf(l)+1||(a=!1),i+=s.size}}var o=!0;if(e.params.filesize){var c=e.params.filesize,u=(e.params.filesize,{"мб":1048576,mb:1048576,"кб":1024,kb:1024});for(var f in u)"string"==typeof c&&c.indexOf(f)+1&&(c=+c.replace(f,"")*u[f]);o=i<=c}var d=[];a||d.push(this.getMessage.call(e,"filetype",[e.params.filetype])),o||d.push(this.getMessage.call(e,"filesize",[e.params.filesize])),t(e,d)},required:function(t,r){var a=t.$el.get(0);r(t,("radio"===a.type||"checkbox"===a.type?this.$form.find('[name="'+a.name+'"]:checked').length:""!==e.trim(a.value))?"":this.getMessage.call(t,"required"))},important:function(e,t){t(e)},phone_all:function(e,r){var a=e.$el;if(!a.val())return r(e),!0;var i=t(a.val());r(e,i.length>5&&/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{6,10}$/.test(i)?"":this.getMessage.call(e,"phone_all"))},phone:function(e,r){var a=e.$el;if(!a.val())return r(e),!0;var i=t(a.val());r(e,i.length>10&&/^(8|\+7){1}(\d{10})$/.test(i)?"":this.getMessage.call(e,"phone"))},ajax:function(t,r){var a=this,i=t.$el;if(!i.val())return r(t),!0;a.callEvent("lockField",i);var n=t.params.ajaxUrl;n.length>0&&e.ajax({url:n,type:"POST",dataType:"html",data:{name:i.attr("name"),value:i.val()}}).done(function(e){if(e.length>0)return void r(t,e);r(t)}).fail(function(){console.error("citrusValidator: ajax validate error"),r(t)}).always(function(){a.callEvent("unlockField",i)})},email:function(t,r){var a=t.$el;if(!a.val())return r(t),!0;r(t,/^(|(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6})$/.test(e.trim(a.val()))?"":this.getMessage.call(t,"email"))},number:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;if(!/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(r.val()))return void t(e,this.getMessage.call(e,"number"));var a,i,n=+r.val(),s="",l=!1,o=!1;void 0!==e.params.min&&""!==e.params.min&&(a=+e.params.min,l=!0),void 0!==e.params.max&&""!==e.params.max&&(i=+e.params.max,o=!0),l&&o?(n<a||n>i)&&(s=this.getMessage.call(e,"range",[a,i])):(l&&n<a&&(s=this.getMessage.call(e,"min",[a])),o&&n>i&&(s=this.getMessage.call(e,"max",[i]))),t(e,s)},length:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var a=e.params.minlength,i=e.params.maxlength,n=r.val().length,s=!1;void 0!==a&&void 0!==i?(n>i||n<a)&&(s=this.getMessage.call(e,"rangelength",[a,i])):void 0!==a?n<a&&(s=this.getMessage.call(e,"minlength",[a])):void 0!==i&&n>i&&(s=this.getMessage.call(e,"maxlength",[i])),t(e,s)},login:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,/[a-zA-Z1-9]+$/.test(r.val())?"":this.getMessage.call(e,"login"))},main_password:function(t,r){var a=t.$el,i=this.filterField(function(t){return e.inArray("confirm_password",t.arRules)+1})[0];i.$el.val()&&a.val()&&this.validateField(i),r(t)},confirm_password:function(t,r){var a=t.$el;if(!a.val())return r(t),!0;var i=this.filterField(function(t){return e.inArray("main_password",t.arRules)+1})[0];r(t,a.val()===i.$el.val()?"":this.getMessage.call(t,"confirm_password"))},url:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(r.val())?"":this.getMessage.call(e,"url"))},recaptcha:function(e,t){if("undefined"==typeof grecaptcha)return void t(e);var r=e.$el.data("widget-id");t(e,grecaptcha.getResponse(r)?"":this.getMessage.call(e,"recaptcha"))},inn:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,a(r.val(),{})?"":this.getMessage.call(e,"inn"))},inn_u:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var a=r.val(),i=!0;a.match(/\D/)&&(i=!1),10!=a.length&&(i=!1);var n=String((2*a[0]+4*a[1]+10*a[2]+3*a[3]+5*a[4]+9*a[5]+4*a[6]+6*a[7]+8*a[8])%11%10);i=a[9]==n,t(e,i?"":this.getMessage.call(e,"inn_u"))},inn_f:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var a=r.val(),i=!0;a.match(/\D/)&&(i=!1),i=12==a.length&&a[10]==(7*a[0]+2*a[1]+4*a[2]+10*a[3]+3*a[4]+5*a[5]+9*a[6]+4*a[7]+6*a[8]+8*a[9])%11%10&&a[11]==(3*a[0]+7*a[1]+2*a[2]+4*a[3]+10*a[4]+3*a[5]+5*a[6]+9*a[7]+4*a[8]+6*a[9]+8*a[10])%11%10,t(e,i?"":this.getMessage.call(e,"inn_f"))},ogrn:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,s(r.val(),{})?"":this.getMessage.call(e,"ogrn"))},kpp:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,i(r.val(),{})?"":this.getMessage.call(e,"kpp"))},bik:function(t,a){var i=t.$el,n=this;if(!i.val())return a(t),!0;var s=r(i.val(),{});if(a(t,s?"":this.getMessage.call(t,"bik")),s){var l=this.filterField(function(t){return e.inArray("ks",t.arRules)+1});e(l).each(function(e,t){var r=Object.create(t);r.arRules=["ks"],n.validateField(r)});var o=this.filterField(function(t){return e.inArray("rs",t.arRules)+1});e(o).each(function(e,t){var r=Object.create(t);r.arRules=["rs"],n.validateField(r)})}},ogrnip:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;t(e,l(r.val(),{})?"":this.getMessage.call(e,"ogrnip"))},ks:function(t,r){var a,i,s,l=t.$el,o=l.val(),c=!0;if(!l.val())return r(t),!0;var u=/\d/.test(o)&&20===o.length;a=this.filterField(function(t){return e.inArray("bik",t.arRules)+1}),a.length&&(a=a[0],i=a.$el.val(),u&&i&&a.isValid&&(c=n(o,i,{}))),s=u?"":this.getMessage.call(t,"ks"),c||(s=this.getMessage.call(t,"ks")+" "+this.getMessage.call(t,"bikBased",[i])),r(t,s)},rs:function(t,r){var a,i,n,s=t.$el,l=s.val(),c=!0;if(!s.val())return r(t),!0;var u=/\d/.test(l)&&20===l.length;a=this.filterField(function(t){return e.inArray("bik",t.arRules)+1}),a.length&&(a=a[0],i=a.$el.val(),u&&i&&a.isValid&&(c=o(l,i,{}))),n=u?"":this.getMessage.call(t,"rs"),c||(n=this.getMessage.call(t,"rs")+" "+this.getMessage.call(t,"bikBased",[i])),r(t,n)},snils:function(e,r){var a=e.$el.val();if(!(a=t(a)))return r(e),!0;r(e,c(a,{})?"":this.getMessage.call(e,"snils"))}},g={addFieldError:function(e,t){var r=e.parents(this.settings.input_container);r.addClass("has-error").removeClass("has-success");var a=t.join("<br>"),i=r.find(".error.help-block");i.length>0?i.html(a):r.append('<div class="error help-block">'+a+"</div>")},removeFieldError:function(e){e.parents(this.settings.input_container).removeClass("has-error").addClass("has-success")},addGroupError:function(e,t){if(e){var r=this;t.forEach(function(t){var a=t.$el.parents(r.settings.input_container);a.addClass("has-group-error").removeClass("has-group-success");var i=a.find(".group-error.help-block"),n=r.requireGroup[e].error;i.length>0?i.html(n):a.append('<div class="group-error help-block">'+n+"</div>")})}},removeGroupError:function(e,t){if(e){var r=this;t.forEach(function(e){e.$el.parents(r.settings.input_container).addClass("has-group-success").removeClass("has-group-error")})}},clearField:function(e){e.parents(this.settings.input_container).removeClass("has-error").removeClass("has-success")},lockField:function(e){this.callEvent("removeFieldError",e),e.attr("readonly","readonly").closest(this.settings.input_container).addClass("ajax-loading")},unlockField:function(e){e.removeAttr("readonly").closest(this.settings.input_container).removeClass("ajax-loading")},lockForm:function(){var e=this;e.isLocked=!0,e.$form.find(e.settings.submitBtn).attr("disabled","disabled")},unlockForm:function(){var e=this;e.isLocked=!1,e.$form.find(e.settings.submitBtn).removeAttr("disabled")},afterFormValidate:function(){this.isValid&&this.$form.submit()},scrollToFirstError:function(){var e=this,t=this.filterField(function(t){return!1===t.isValid||t.params.requireGroup&&!1===e.requireGroup[t.params.requireGroup].isValid});t.length&&t[0].$el.first().focus()},reset:function(){var e=this;e.$form[0].reset(),e.fields.forEach(function(t,r,a){e.callEvent("clearField",t.$el),delete t.isValid}),e.callEvent(e.checkImportant()?"unlockForm":"lockForm")}},v=[],h=new function(){this._getMessage=function(e,t){if(f[e]&&f[e].length>0){var r=f[e];return t&&t.length>0?(t.forEach(function(e,t){r=r.replace("{"+t+"}",e)}),r):r}if(!f[e])return f},this._setMessage=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if("string"!=typeof t[a])return!1;f[a]=t[a]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof r&&(f[t]=r,!0)},this._getRule=function(e){return e?d[e]||!1:d},this._setRule=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if(!e.isFunction(t[a]))return!1;d[a]=t[a]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(d[t]=r,!0)},this._getEvent=function(e){return e?g[e]||function(){}:g},this._setEvent=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if("string"!=typeof a||!e.isFunction(t[a]))return!1;g[a]=t[a]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(g[t]=r,!0)},this._getValidator=function(e){return u(e)||e.length?v.filter(function(t){return e.is(t.$form)}):[]},this._addValidator=function(e){v.push(e)},this._removeValidator=function(t){var t=[].concat(t);v=v.filter(function(r){return!(e.inArray(r,t)+1)})}};"undefined"!=typeof BX&&BX.message("citrusValidator")&&h._setMessage(BX.message("citrusValidator")),window.citrusValidator=function(t,r){if(!t||1!=t.length)throw new Error("citrusValidator: ошибка в аргументе form");var a=this,i=Object.create(a._getRule()),n=Object.create(a._getMessage()),s=Object.create(a._getEvent());a.settings=e.extend({submitBtn:":submit",input_container:".input-container",checkInit:!0},r),a.$form=t,a.$submitBtn=a.$form.find(a.settings.submitBtn),a.fields=[],a.requireGroup={},a.isLocked=!1,a.getMessage=function(t,r){var a=this.messages&&this.messages[t]?this.messages[t]:n[t]?n[t]:"";return a.length>0&&"array"===e.type(r)&&r.length>0&&r.forEach(function(e,t){a=a.replace("{"+t+"}",e)}),a},a.setMessage=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if("string"!=typeof t[a])return!1;n[a]=t[a]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof r&&(n[t]=r,!0)},a.getRule=function(e){return e?i[e]||!1:i},a.setRule=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if(!e.isFunction(t[a]))return!1;i[a]=t[a]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(i[t]=r,!0)},a.getEvent=function(e){return e?s[e]||!1:s},a.setEvent=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var a in t){if("string"!=typeof a||!e.isFunction(t[a]))return!1;s[a]=t[a]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(s[t]=r,!0)},a.callEvent=function(e,t,r){if(e)return this.getEvent(e).call(this,t,r),this},a.getField=function(t){return t?a.fields.filter(function(r){return e(r.$el).is(t)}):a.fields},a.filterField=function(t){if(!t||!e.isFunction(t))throw new Error("citrusValidator: ошибка в аргументе функции filterField");return a.fields.filter(t)},a.validateField=function(t,r,i){var n=[].concat(t),r=void 0===r||r,i=i||function(){};n.forEach(function(t){var n=t.arRules.length,s=[],l=function(){t.errors=s,t.params.trigger||t.$el.is(":checkbox, :file, :radio, select")||(t.params.trigger="keyup"),s.length>0?(r&&a.callEvent("addFieldError",t.$el,s),t.$el.trigger("validError",[t]),t.isValid=!1):t.$el.is(":checkbox, :radio")||t.$el.val()?(r&&a.callEvent("removeFieldError",t.$el),t.$el.trigger("validSucess",[t]),t.isValid=!0):(r&&a.callEvent("clearField",t.$el),delete t.isValid),i(t,s)};return t.$el.prop("disabled")?(r&&a.callEvent("clearField",t.$el),delete t.isValid,void l()):n?void t.arRules.forEach(function(r){var i=a.getRule(r);return i&&e.isFunction(i)?(i.call(a,t,function(e,t){t&&t.length&&(s[s.length]=t),--n||l()}),!0):(console.warn("citrusValidator: Нет правила '"+r+"'"),--n||l(),!0)}):(l(),!0)})},a.validateGroup=function(e,t,r){if(e){var r=r||function(){},t=void 0===t||!!t,i=!1,n=!0,s=!1,l=a.requireGroup[e].logic||"or",o=a.filterField(function(t){return t.params.requireGroup==e}),c=[];if(o.forEach(function(e,t,r){var s=e.params.name||e.$el.attr("name");s&&c.push(s);var l={};l.$el=e.$el,l.arRules=["required"],l.params=[],a.validateField(l,!1,function(e,t){t.length||(i=!0),t.length&&(n=!1)})}),s="or"===l&&i||"and"===l&&n,t){var u=c.join(", "),f="or"===l?a.getMessage("orGroup",[u]):"and"===l?a.getMessage("andGroup",[u]):"";a.requireGroup[e].error||(a.requireGroup[e].error=f),a.requireGroup[e].isValid=s,a.callEvent(s?"removeGroupError":"addGroupError",e,o)}r(s,o)}},a.validateForm=function(t,r){var r=r||function(){},t=void 0===t||!!t;a.isValid=!0;var i,n=function(){r(a),t&&a.callEvent("afterFormValidate"),t&&a.callEvent("scrollToFirstError")},s=!0;if(!e.isEmptyObject(a.requireGroup))for(var l in a.requireGroup)i=a.requireGroup[l],!1!==i.isValid?a.validateGroup(l,!0,function(e){!1===e&&(s=!1)}):s=!1;var o=a.fields.length;if(!o)return n(),!0;a.fields.forEach(function(e){void 0!==e.isValid&&"submit"!==e.params.trigger?(e.isValid||(a.isValid=!1),--o||n()):a.validateField(e,t,function(e){e.isValid||void 0===e.isValid||(a.isValid=!1),--o||n()})})},a.checkImportant=function(){var e=a.filterField(function(e){return!!e.params.important}),t=!0;return e.length>0&&e.forEach(function(e){if(void 0!==e.isValid)return void(e.isValid||(t=!1));a.validateField(e,!1,function(e){e.isValid||(t=!1)})}),t},a.addField=function(t,r,i,n){if(!t||"object"!==e.type(t)||!t.length)return void console.error("citrusValidator. v.addField(): $fields не найден");var r=r||[],i=i||{},n=n||{};return t.each(function(t,s){var l=e("radio"==e(this).prop("type")?'[name="'+e(this).prop("name")+'"]':this),o=a.getField(e(s));if(o.length)return o=o[0],o.arRules=e.unique(e.merge(o.arRules.slice(),r)),o.params=e.extend(!0,o.params,i),void(o.messages=e.extend(!0,o.messages,n));var c={$el:l,arRules:r,params:i,messages:n};a.fields[a.fields.length]=c,c.params.requireGroup&&(a.requireGroup[c.params.requireGroup]||(a.requireGroup[c.params.requireGroup]={isValid:void 0,error:""}),c.params.groupLogic&&(a.requireGroup[c.params.requireGroup].logic=c.params.groupLogic)),l.on(a.handlers.field).data("validator-handlers-attached",!0)}),t},a.handlers={field:{"change keyup validate":function(t){if(13!=t.keyCode){var r=a.getField(e(this))[0]||!1;if(!r)return void console.error("Нет поля в массиве полей v.fields");(r.params.trigger||"change").indexOf(t.type)<0&&"validate"!==t.type||(r.params.requireGroup&&a.validateGroup(r.params.requireGroup,!0),a.validateField(r,!0,function(e){e.params.important&&a.callEvent(a.checkImportant()?"unlockForm":"lockForm")}))}}},form:{validate:a.validateForm,keypress:function(e){13==e.keyCode&&"textarea"!==e.target.type&&(e.preventDefault(),a.validateForm())}},btn:{click:function(t){t.preventDefault(),e(this).attr("disabled")||a.validateForm()}}},a.checkAttached=function(e){var t=!0===e.data("validator-handlers-attached");return t&&console.warn("handler already attached"),t},a.attachEvents=function(t){a.checkAttached(a.$form)||a.$form.on(a.handlers.form).data("validator-handlers-attached",!0),a.checkAttached(a.$submitBtn)||a.$submitBtn.on(a.handlers.btn).data("validator-handlers-attached",!0),u(t)&&!1!==t&&e(a.fields).each(function(t,r){r.$el.each(function(t,r){a.checkAttached(e(r))||e(r).on(a.handlers.field).data("validator-handlers-attached",!0)})})},a.detachEvents=function(){a.$form.off(a.handlers.form).data("validator-handlers-attached",!1),a.$submitBtn.off(a.handlers.btn).data("validator-handlers-attached",!1),e(a.fields).each(function(t,r){r.$el.each(function(t,r){e(r).off(a.handlers.field).data("validator-handlers-attached",!1)})})},a.destroy=function(){a.detachEvents(),a._removeValidator(a),a.fields=[]},a.init=function(){a.$form.find("[data-valid], [data-valid-params], [data-valid-messages]").each(function(t,r){var i=e(r).data(),n=i.valid?i.valid.split(" "):[],s=i.validParams||{},l=i.validMessages||{};for(var o in i){if(o.indexOf("validParam")+1){var c=o.replace("validParam","");c[0]===c[0].toUpperCase()&&(c=c.toLowerCase(),s[c]=i[o])}if(o.indexOf("validMessage")+1){var u=o.replace("validMessage","");u[0]===u[0].toUpperCase()&&(u=u.toLowerCase(),l[u]=i[o])}}!n.length&&e.isEmptyObject(s)&&e.isEmptyObject(l)||a.addField(e(r),n,s,l)}),a.checkImportant()||a.callEvent("lockForm"),a.attachEvents(!1),a._addValidator(a)},function(){var e=h._getValidator(a.$form);if(e.length){if(a.settings.checkInit)return void console.warn("Validator already init");a._removeValidator(e)}a.init()}()},e.fn.citrusValidator=function(t){var r=this;if(u(t)&&"get"===t)return h._getValidator(r);if(!u(t)||"destroy"!==t){var t=t||{};return r.each(function(r,a){new citrusValidator(e(a),t)})}e(h._getValidator(r)).each(function(e,t){t.destroy()})},citrusValidator.prototype=h}(jQuery);